{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\marcorebollo\\\\Documents\\\\DesarrollosUdm\\\\prueba_fronted\\\\pruebafrontend\\\\social-app\\\\src\\\\pages\\\\PostsPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { getAllPosts } from '../services/postService';\nimport PostCard from '../components/PostCard/PostCard'; // Asegúrate de que la ruta sea correcta\nimport { useNavigate } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PostsPage = () => {\n  _s();\n  const {\n    token,\n    isAuthenticated,\n    loading: authLoading,\n    user\n  } = useAuth();\n  const [posts, setPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const navigate = useNavigate();\n  const fetchPosts = useCallback(async () => {\n    if (!isAuthenticated || !token) {\n      // Si no está autenticado, redirigir al login\n      navigate('/login');\n      return;\n    }\n    try {\n      setLoading(true);\n      setError('');\n      const data = await getAllPosts(token);\n      // El backend no devuelve `likedByCurrentUser`, así que lo simulamos aquí o lo obtenemos de otra manera.\n      // Para una implementación real, el backend debería indicar si el usuario actual ya dio like.\n      const postsWithLikeStatus = data.map(p => ({\n        ...p,\n        likedByCurrentUser: false // Simulamos que no hay likes del usuario por defecto\n        // Esto necesita ser real si el backend lo proporciona\n      }));\n      setPosts(postsWithLikeStatus);\n    } catch (err) {\n      console.error(\"Failed to fetch posts:\", err);\n      setError('Failed to load posts. Please try again.');\n      if (err.response && err.response.status === 401) {\n        // Si el token es inválido, forzar logout\n        // logout(); // Esto podría ser llamado desde AuthContext\n        navigate('/login');\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, [isAuthenticated, token, navigate]);\n  useEffect(() => {\n    if (!authLoading) {\n      // Esperar a que el contexto de autenticación termine de cargar\n      fetchPosts();\n    }\n  }, [fetchPosts, authLoading]);\n  const handleLikeToggle = useCallback(postId => {\n    setPosts(prevPosts => prevPosts.map(p => {\n      if (p.id === postId) {\n        const newLikesCount = p.likedByCurrentUser ? p.likesCount - 1 : p.likesCount + 1;\n        return {\n          ...p,\n          likesCount: newLikesCount,\n          likedByCurrentUser: !p.likedByCurrentUser // Toggle localmente el estado del like\n        };\n      }\n      return p;\n    }));\n  }, []);\n  if (loading || authLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-message\",\n      children: \"Loading posts...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 16\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 16\n    }, this);\n  }\n  if (posts.length === 0) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"no-posts-message\",\n      children: \"No posts available.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 16\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"posts-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Publicaciones\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"posts-list\",\n      children: posts.map(post => /*#__PURE__*/_jsxDEV(PostCard, {\n        post: post,\n        onLikeToggle: handleLikeToggle\n      }, post.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 21\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 80,\n    columnNumber: 9\n  }, this);\n};\n_s(PostsPage, \"7kyzaFLxNmPXb4CYGNLhjxOZEYk=\", false, function () {\n  return [useAuth, useNavigate];\n});\n_c = PostsPage;\nexport default PostsPage;\nvar _c;\n$RefreshReg$(_c, \"PostsPage\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useAuth","getAllPosts","PostCard","useNavigate","jsxDEV","_jsxDEV","PostsPage","_s","token","isAuthenticated","loading","authLoading","user","posts","setPosts","setLoading","error","setError","navigate","fetchPosts","data","postsWithLikeStatus","map","p","likedByCurrentUser","err","console","response","status","handleLikeToggle","postId","prevPosts","id","newLikesCount","likesCount","className","children","fileName","_jsxFileName","lineNumber","columnNumber","length","post","onLikeToggle","_c","$RefreshReg$"],"sources":["C:/Users/marcorebollo/Documents/DesarrollosUdm/prueba_fronted/pruebafrontend/social-app/src/pages/PostsPage.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { getAllPosts } from '../services/postService';\nimport PostCard from '../components/PostCard/PostCard'; // Asegúrate de que la ruta sea correcta\nimport { useNavigate } from 'react-router-dom';\n\nconst PostsPage = () => {\n    const { token, isAuthenticated, loading: authLoading, user } = useAuth();\n    const [posts, setPosts] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState('');\n    const navigate = useNavigate();\n\n    const fetchPosts = useCallback(async () => {\n        if (!isAuthenticated || !token) {\n            // Si no está autenticado, redirigir al login\n            navigate('/login');\n            return;\n        }\n        try {\n            setLoading(true);\n            setError('');\n            const data = await getAllPosts(token);\n            // El backend no devuelve `likedByCurrentUser`, así que lo simulamos aquí o lo obtenemos de otra manera.\n            // Para una implementación real, el backend debería indicar si el usuario actual ya dio like.\n            const postsWithLikeStatus = data.map(p => ({\n                ...p,\n                likedByCurrentUser: false // Simulamos que no hay likes del usuario por defecto\n                                          // Esto necesita ser real si el backend lo proporciona\n            }));\n            setPosts(postsWithLikeStatus);\n        } catch (err) {\n            console.error(\"Failed to fetch posts:\", err);\n            setError('Failed to load posts. Please try again.');\n            if (err.response && err.response.status === 401) {\n                // Si el token es inválido, forzar logout\n                // logout(); // Esto podría ser llamado desde AuthContext\n                navigate('/login');\n            }\n        } finally {\n            setLoading(false);\n        }\n    }, [isAuthenticated, token, navigate]);\n\n    useEffect(() => {\n        if (!authLoading) { // Esperar a que el contexto de autenticación termine de cargar\n            fetchPosts();\n        }\n    }, [fetchPosts, authLoading]);\n\n    const handleLikeToggle = useCallback((postId) => {\n        setPosts(prevPosts =>\n            prevPosts.map(p => {\n                if (p.id === postId) {\n                    const newLikesCount = p.likedByCurrentUser ? p.likesCount - 1 : p.likesCount + 1;\n                    return {\n                        ...p,\n                        likesCount: newLikesCount,\n                        likedByCurrentUser: !p.likedByCurrentUser // Toggle localmente el estado del like\n                    };\n                }\n                return p;\n            })\n        );\n    }, []);\n\n    if (loading || authLoading) {\n        return <div className=\"loading-message\">Loading posts...</div>;\n    }\n\n    if (error) {\n        return <div className=\"error-message\">{error}</div>;\n    }\n\n    if (posts.length === 0) {\n        return <div className=\"no-posts-message\">No posts available.</div>;\n    }\n\n    return (\n        <div className=\"posts-page\">\n            <h2>Publicaciones</h2>\n            <div className=\"posts-list\">\n                {posts.map(post => (\n                    <PostCard key={post.id} post={post} onLikeToggle={handleLikeToggle} />\n                ))}\n            </div>\n        </div>\n    );\n};\n\nexport default PostsPage;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}