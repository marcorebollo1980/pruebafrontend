{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext}from'react';import{loginUser}from'../services/authService';// Se implementará más tarde\nimport{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);export const AuthProvider=_ref=>{let{children}=_ref;const[isAuthenticated,setIsAuthenticated]=useState(false);const[user,setUser]=useState(null);const[token,setToken]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{// Al cargar la aplicación, intenta recuperar el token y el usuario del almacenamiento local\nconst storedToken=localStorage.getItem('jwt_token');const storedUser=localStorage.getItem('user');if(storedToken&&storedUser){try{const parsedUser=JSON.parse(storedUser);setToken(storedToken);setUser(parsedUser);setIsAuthenticated(true);}catch(e){console.error(\"Error parsing stored user data:\",e);logout();// Si hay un error, limpiar los datos corruptos\n}}setLoading(false);},[]);const login=async(username,password)=>{try{const response=await loginUser(username,password);// Llama al servicio de autenticación\nconst newToken=response.token;// Aquí, en un caso real, decodificarías el token o harías otra llamada\n// para obtener los detalles completos del usuario.\n// Por simplicidad, asumimos que el username es suficiente por ahora.\nconst tempUser=response.user||{username:username,id:response.userId||response.id||null};// Si el backend devuelve userId o id\nsetToken(newToken);setUser(tempUser);setIsAuthenticated(true);localStorage.setItem('jwt_token',newToken);localStorage.setItem('user',JSON.stringify(tempUser));// Guarda el usuario como string\nreturn true;}catch(error){console.error(\"Login failed:\",error);logout();throw error;// Propaga el error para que el componente de login lo maneje\n}};const logout=()=>{setToken(null);setUser(null);setIsAuthenticated(false);localStorage.removeItem('jwt_token');localStorage.removeItem('user');};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isAuthenticated,user,token,loading,login,logout},children:children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","loginUser","jsx","_jsx","AuthContext","AuthProvider","_ref","children","isAuthenticated","setIsAuthenticated","user","setUser","token","setToken","loading","setLoading","storedToken","localStorage","getItem","storedUser","parsedUser","JSON","parse","e","console","error","logout","login","username","password","response","newToken","tempUser","id","userId","setItem","stringify","removeItem","Provider","value","useAuth"],"sources":["C:/Users/marcorebollo/Documents/DesarrollosUdm/prueba_fronted/pruebafrontend/social-app/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from 'react';\nimport { loginUser } from '../services/authService'; // Se implementará más tarde\n\nconst AuthContext = createContext(null);\n\nexport const AuthProvider = ({ children }) => {\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\n    const [user, setUser] = useState(null);\n    const [token, setToken] = useState(null);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        // Al cargar la aplicación, intenta recuperar el token y el usuario del almacenamiento local\n        const storedToken = localStorage.getItem('jwt_token');\n        const storedUser = localStorage.getItem('user');\n\n        if (storedToken && storedUser) {\n            try {\n                const parsedUser = JSON.parse(storedUser);\n                setToken(storedToken);\n                setUser(parsedUser);\n                setIsAuthenticated(true);\n            } catch (e) {\n                console.error(\"Error parsing stored user data:\", e);\n                logout(); // Si hay un error, limpiar los datos corruptos\n            }\n        }\n        setLoading(false);\n    }, []);\n\n    const login = async (username, password) => {\n        try {\n            const response = await loginUser(username, password); // Llama al servicio de autenticación\n            const newToken = response.token;\n            // Aquí, en un caso real, decodificarías el token o harías otra llamada\n            // para obtener los detalles completos del usuario.\n            // Por simplicidad, asumimos que el username es suficiente por ahora.\n            const tempUser = response.user || { username: username, id: response.userId || response.id || null }; // Si el backend devuelve userId o id\n            \n            setToken(newToken);\n            setUser(tempUser);\n            setIsAuthenticated(true);\n            localStorage.setItem('jwt_token', newToken);\n            localStorage.setItem('user', JSON.stringify(tempUser)); // Guarda el usuario como string\n            return true;\n        } catch (error) {\n            console.error(\"Login failed:\", error);\n            logout();\n            throw error; // Propaga el error para que el componente de login lo maneje\n        }\n    };\n\n    const logout = () => {\n        setToken(null);\n        setUser(null);\n        setIsAuthenticated(false);\n        localStorage.removeItem('jwt_token');\n        localStorage.removeItem('user');\n    };\n\n    return (\n        <AuthContext.Provider value={{ isAuthenticated, user, token, loading, login, logout }}>\n            {children}\n        </AuthContext.Provider>\n    );\n};\n\nexport const useAuth = () => useContext(AuthContext);\n\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,QAAQ,CAAEC,SAAS,CAAEC,UAAU,KAAQ,OAAO,CAC7E,OAASC,SAAS,KAAQ,yBAAyB,CAAE;AAAA,OAAAC,GAAA,IAAAC,IAAA,yBAErD,KAAM,CAAAC,WAAW,cAAGP,aAAa,CAAC,IAAI,CAAC,CAEvC,MAAO,MAAM,CAAAQ,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACrC,KAAM,CAACE,eAAe,CAAEC,kBAAkB,CAAC,CAAGX,QAAQ,CAAC,KAAK,CAAC,CAC7D,KAAM,CAACY,IAAI,CAAEC,OAAO,CAAC,CAAGb,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACc,KAAK,CAAEC,QAAQ,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CACxC,KAAM,CAACgB,OAAO,CAAEC,UAAU,CAAC,CAAGjB,QAAQ,CAAC,IAAI,CAAC,CAE5CC,SAAS,CAAC,IAAM,CACZ;AACA,KAAM,CAAAiB,WAAW,CAAGC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC,CACrD,KAAM,CAAAC,UAAU,CAAGF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAE/C,GAAIF,WAAW,EAAIG,UAAU,CAAE,CAC3B,GAAI,CACA,KAAM,CAAAC,UAAU,CAAGC,IAAI,CAACC,KAAK,CAACH,UAAU,CAAC,CACzCN,QAAQ,CAACG,WAAW,CAAC,CACrBL,OAAO,CAACS,UAAU,CAAC,CACnBX,kBAAkB,CAAC,IAAI,CAAC,CAC5B,CAAE,MAAOc,CAAC,CAAE,CACRC,OAAO,CAACC,KAAK,CAAC,iCAAiC,CAAEF,CAAC,CAAC,CACnDG,MAAM,CAAC,CAAC,CAAE;AACd,CACJ,CACAX,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAY,KAAK,CAAG,KAAAA,CAAOC,QAAQ,CAAEC,QAAQ,GAAK,CACxC,GAAI,CACA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAA7B,SAAS,CAAC2B,QAAQ,CAAEC,QAAQ,CAAC,CAAE;AACtD,KAAM,CAAAE,QAAQ,CAAGD,QAAQ,CAAClB,KAAK,CAC/B;AACA;AACA;AACA,KAAM,CAAAoB,QAAQ,CAAGF,QAAQ,CAACpB,IAAI,EAAI,CAAEkB,QAAQ,CAAEA,QAAQ,CAAEK,EAAE,CAAEH,QAAQ,CAACI,MAAM,EAAIJ,QAAQ,CAACG,EAAE,EAAI,IAAK,CAAC,CAAE;AAEtGpB,QAAQ,CAACkB,QAAQ,CAAC,CAClBpB,OAAO,CAACqB,QAAQ,CAAC,CACjBvB,kBAAkB,CAAC,IAAI,CAAC,CACxBQ,YAAY,CAACkB,OAAO,CAAC,WAAW,CAAEJ,QAAQ,CAAC,CAC3Cd,YAAY,CAACkB,OAAO,CAAC,MAAM,CAAEd,IAAI,CAACe,SAAS,CAACJ,QAAQ,CAAC,CAAC,CAAE;AACxD,MAAO,KAAI,CACf,CAAE,MAAOP,KAAK,CAAE,CACZD,OAAO,CAACC,KAAK,CAAC,eAAe,CAAEA,KAAK,CAAC,CACrCC,MAAM,CAAC,CAAC,CACR,KAAM,CAAAD,KAAK,CAAE;AACjB,CACJ,CAAC,CAED,KAAM,CAAAC,MAAM,CAAGA,CAAA,GAAM,CACjBb,QAAQ,CAAC,IAAI,CAAC,CACdF,OAAO,CAAC,IAAI,CAAC,CACbF,kBAAkB,CAAC,KAAK,CAAC,CACzBQ,YAAY,CAACoB,UAAU,CAAC,WAAW,CAAC,CACpCpB,YAAY,CAACoB,UAAU,CAAC,MAAM,CAAC,CACnC,CAAC,CAED,mBACIlC,IAAA,CAACC,WAAW,CAACkC,QAAQ,EAACC,KAAK,CAAE,CAAE/B,eAAe,CAAEE,IAAI,CAAEE,KAAK,CAAEE,OAAO,CAAEa,KAAK,CAAED,MAAO,CAAE,CAAAnB,QAAA,CACjFA,QAAQ,CACS,CAAC,CAE/B,CAAC,CAED,MAAO,MAAM,CAAAiC,OAAO,CAAGA,CAAA,GAAMxC,UAAU,CAACI,WAAW,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}