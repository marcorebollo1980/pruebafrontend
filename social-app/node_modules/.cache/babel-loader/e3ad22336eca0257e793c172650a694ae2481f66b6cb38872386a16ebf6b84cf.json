{"ast":null,"code":"import _objectSpread from\"C:/Users/marcorebollo/Documents/DesarrollosUdm/prueba_fronted/pruebafrontend/social-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{useAuth}from'../contexts/AuthContext';import{getAllPosts}from'../services/postService';import PostCard from'../components/PostCard/PostCard';// Asegúrate de que la ruta sea correcta\nimport{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PostsPage=()=>{const{token,isAuthenticated,loading:authLoading,user}=useAuth();const[posts,setPosts]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const navigate=useNavigate();const fetchPosts=useCallback(async()=>{if(!isAuthenticated||!token){// Si no está autenticado, redirigir al login\nnavigate('/login');return;}try{setLoading(true);setError('');const data=await getAllPosts(token);// El backend no devuelve `likedByCurrentUser`, así que lo simulamos aquí o lo obtenemos de otra manera.\n// Para una implementación real, el backend debería indicar si el usuario actual ya dio like.\nconst postsWithLikeStatus=data.map(p=>_objectSpread(_objectSpread({},p),{},{likedByCurrentUser:false// Simulamos que no hay likes del usuario por defecto\n// Esto necesita ser real si el backend lo proporciona\n}));setPosts(postsWithLikeStatus);}catch(err){console.error(\"Failed to fetch posts:\",err);setError('Failed to load posts. Please try again.');if(err.response&&err.response.status===401){// Si el token es inválido, forzar logout\n// logout(); // Esto podría ser llamado desde AuthContext\nnavigate('/login');}}finally{setLoading(false);}},[isAuthenticated,token,navigate]);useEffect(()=>{if(!authLoading){// Esperar a que el contexto de autenticación termine de cargar\nfetchPosts();}},[fetchPosts,authLoading]);const handleLikeToggle=useCallback(postId=>{setPosts(prevPosts=>prevPosts.map(p=>{if(p.id===postId){const newLikesCount=p.likedByCurrentUser?p.likesCount-1:p.likesCount+1;return _objectSpread(_objectSpread({},p),{},{likesCount:newLikesCount,likedByCurrentUser:!p.likedByCurrentUser// Toggle localmente el estado del like\n});}return p;}));},[]);if(loading||authLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-message\",children:\"Loading posts...\"});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error});}if(posts.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"no-posts-message\",children:\"No posts available.\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"posts-page\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Publicaciones\"}),/*#__PURE__*/_jsx(\"div\",{className:\"posts-list\",children:posts.map(post=>/*#__PURE__*/_jsx(PostCard,{post:post,onLikeToggle:handleLikeToggle},post.id))})]});};export default PostsPage;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useAuth","getAllPosts","PostCard","useNavigate","jsx","_jsx","jsxs","_jsxs","PostsPage","token","isAuthenticated","loading","authLoading","user","posts","setPosts","setLoading","error","setError","navigate","fetchPosts","data","postsWithLikeStatus","map","p","_objectSpread","likedByCurrentUser","err","console","response","status","handleLikeToggle","postId","prevPosts","id","newLikesCount","likesCount","className","children","length","post","onLikeToggle"],"sources":["C:/Users/marcorebollo/Documents/DesarrollosUdm/prueba_fronted/pruebafrontend/social-app/src/pages/PostsPage.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { getAllPosts } from '../services/postService';\nimport PostCard from '../components/PostCard/PostCard'; // Asegúrate de que la ruta sea correcta\nimport { useNavigate } from 'react-router-dom';\n\nconst PostsPage = () => {\n    const { token, isAuthenticated, loading: authLoading, user } = useAuth();\n    const [posts, setPosts] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState('');\n    const navigate = useNavigate();\n\n    const fetchPosts = useCallback(async () => {\n        if (!isAuthenticated || !token) {\n            // Si no está autenticado, redirigir al login\n            navigate('/login');\n            return;\n        }\n        try {\n            setLoading(true);\n            setError('');\n            const data = await getAllPosts(token);\n            // El backend no devuelve `likedByCurrentUser`, así que lo simulamos aquí o lo obtenemos de otra manera.\n            // Para una implementación real, el backend debería indicar si el usuario actual ya dio like.\n            const postsWithLikeStatus = data.map(p => ({\n                ...p,\n                likedByCurrentUser: false // Simulamos que no hay likes del usuario por defecto\n                                          // Esto necesita ser real si el backend lo proporciona\n            }));\n            setPosts(postsWithLikeStatus);\n        } catch (err) {\n            console.error(\"Failed to fetch posts:\", err);\n            setError('Failed to load posts. Please try again.');\n            if (err.response && err.response.status === 401) {\n                // Si el token es inválido, forzar logout\n                // logout(); // Esto podría ser llamado desde AuthContext\n                navigate('/login');\n            }\n        } finally {\n            setLoading(false);\n        }\n    }, [isAuthenticated, token, navigate]);\n\n    useEffect(() => {\n        if (!authLoading) { // Esperar a que el contexto de autenticación termine de cargar\n            fetchPosts();\n        }\n    }, [fetchPosts, authLoading]);\n\n    const handleLikeToggle = useCallback((postId) => {\n        setPosts(prevPosts =>\n            prevPosts.map(p => {\n                if (p.id === postId) {\n                    const newLikesCount = p.likedByCurrentUser ? p.likesCount - 1 : p.likesCount + 1;\n                    return {\n                        ...p,\n                        likesCount: newLikesCount,\n                        likedByCurrentUser: !p.likedByCurrentUser // Toggle localmente el estado del like\n                    };\n                }\n                return p;\n            })\n        );\n    }, []);\n\n    if (loading || authLoading) {\n        return <div className=\"loading-message\">Loading posts...</div>;\n    }\n\n    if (error) {\n        return <div className=\"error-message\">{error}</div>;\n    }\n\n    if (posts.length === 0) {\n        return <div className=\"no-posts-message\">No posts available.</div>;\n    }\n\n    return (\n        <div className=\"posts-page\">\n            <h2>Publicaciones</h2>\n            <div className=\"posts-list\">\n                {posts.map(post => (\n                    <PostCard key={post.id} post={post} onLikeToggle={handleLikeToggle} />\n                ))}\n            </div>\n        </div>\n    );\n};\n\nexport default PostsPage;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}